# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –∞–Ω—Ç–∏–±–æ—Ç-—Å–∏—Å—Ç–µ–º—ã Ozon

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ—Ç Grok, ChatGPT, Perplexity)

### ‚úÖ 1. –°–æ–∑–¥–∞–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ OzonAntibotException (Perplexity Fix #2)

**–§–∞–π–ª:** `src/exceptions.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `OzonAntibotException` –¥–ª—è —è–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∞–Ω—Ç–∏–±–æ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ docstring –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.exceptions import OzonAntibotException

try:
    # –∫–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞
except OzonAntibotException as e:
    logger.error(f"–ê–Ω—Ç–∏–±–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: {e}")
    # –°–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É, —Å–º–µ–Ω–∏—Ç—å IP –∏ —Ç.–¥.
```

---

### ‚úÖ 2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ 403 Forbidden (Perplexity Fix #2)

**–§–∞–π–ª:** `src/api/ozon_catalog_api.py`, –º–µ—Ç–æ–¥ `_fetch_page()`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ `ozon-antibot` –≤ –æ—Ç–≤–µ—Ç–µ
- –°—á–µ—Ç—á–∏–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –∞–Ω—Ç–∏–±–æ—Ç–∞ (`_antibot_triggered_count`)
- –í—ã–±—Ä–æ—Å `OzonAntibotException` –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π

**–õ–æ–≥–∏–∫–∞:**
1. –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å 403 ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies + –∑–∞–¥–µ—Ä–∂–∫–∞ 5 —Å–µ–∫
2. –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å 403 + `ozon-antibot` ‚Üí –≤—ã–±—Ä–æ—Å `OzonAntibotException`

---

### ‚úÖ 3. –£–≤–µ–ª–∏—á–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (Grok/ChatGPT —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

**–§–∞–π–ª:** `src/api/ozon_catalog_api.py`, `__init__()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–î–æ:** `request_delay=1.0`, `max_concurrent=3`
- **–ü–æ—Å–ª–µ:** `request_delay=3.0`, `max_concurrent=2`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ú–µ–Ω—å—à–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –¥–µ—Ç–µ–∫—Ç–∞
- –£–º–µ–Ω—å—à–µ–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è

---

### ‚úÖ 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ proxy (Perplexity Fix #5)

**–§–∞–π–ª:** `src/api/ozon_catalog_api.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `proxy` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ `OzonCatalogAPI`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è proxy –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ 403

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
async with OzonCatalogAPI(
    proxy="http://proxy.example.com:8080"  # –∏–ª–∏ socks5://...
) as api:
    products = await api.fetch_seller_catalog(...)
```

**–í .env —Ñ–∞–π–ª–µ:**
```env
OZON_PROXY=http://proxy.example.com:8080
```

---

### ‚úÖ 5. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ cookies (Perplexity Fix #4)

**–§–∞–π–ª:** `src/api/ozon_catalog_api.py`, –º–µ—Ç–æ–¥ `_log_cookies_diagnostic()`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è cookies
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π 403 –æ—à–∏–±–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
  - –ò—Å—Ç–æ—á–Ω–∏–∫ cookies (–±—Ä–∞—É–∑–µ—Ä/—Ä—É—á–Ω—ã–µ)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∏–º–µ–Ω–∞ cookies
  - –ü–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ cookies:
  ‚Ä¢ –ò—Å—Ç–æ—á–Ω–∏–∫ cookies: –ë—Ä–∞—É–∑–µ—Ä (auto)
  ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ cookies: 2
  ‚Ä¢ –ò–º–µ–Ω–∞ cookies: ['abt_data', '__Secure-ETC']
  ‚Ä¢ abt_data: 7.FX_KR49I2U_5JAFKaVAVEq4qXXcLdGSjeCYDx8AsdM...
```

---

### ‚úÖ 6. –£–ª—É—á—à–µ–Ω–∞ –∏–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Playwright (ChatGPT —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

**–§–∞–π–ª:** `src/utils/playwright_cookies.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–º–∏—Ç–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏–π –º—ã—à–∏ (`page.mouse.move()`)
- –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏–π
- –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å —Å–ª—É—á–∞–π–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (1-2 —Å–µ–∫)
- 4 —ç—Ç–∞–ø–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–¥–∞–≤—Ü–∞ (25%, 50%, 75%, 100%)

**–ö–æ–¥:**
```python
# –ò–º–∏—Ç–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
await page.mouse.move(random.randint(100, 500), random.randint(100, 400))

# –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
await asyncio.sleep(random.uniform(1, 2))
```

---

### ‚úÖ 7. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ headless –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (ChatGPT —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

**–§–∞–π–ª—ã:** 
- `src/utils/playwright_cookies.py` (–ø–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏)
- `.env_sample` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `headless` –≤ `get_ozon_cookies_playwright()`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `OZON_PLAYWRIGHT_HEADLESS` –≤ .env
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
```env
# –í .env
OZON_PLAYWRIGHT_HEADLESS=False
```

–ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –≤–∏–¥–∏–º–æ–º —Ä–µ–∂–∏–º–µ, –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –∞–Ω—Ç–∏–±–æ—Ç–∞.

---

## –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–¥–µ–∏ (DeepSeek)

‚ùå **–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç curl_cffi –≤ –ø–æ–ª—å–∑—É Playwright –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
- –ü—Ä–∏—á–∏–Ω–∞: —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –°—Ç–∞—Ç—É—Å: –æ—Ç–ª–æ–∂–µ–Ω–æ –¥–æ –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

‚ùå **–ü–∞—Ä—Å–∏–Ω–≥ HTML –≤–º–µ—Å—Ç–æ API**
- –ü—Ä–∏—á–∏–Ω–∞: –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —Ç—Ä–µ–±—É–µ—Ç –¥—Ä—É–≥–æ–π –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –°—Ç–∞—Ç—É—Å: —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ API –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```bash
python parse_ozon_sellers.py
```

### 2. –ó–∞–ø—É—Å–∫ —Å –≤–∏–¥–∏–º—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):
```bash
# –í .env
OZON_PLAYWRIGHT_HEADLESS=False

python parse_ozon_sellers.py
```

### 3. –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–∫—Å–∏:
```bash
# –í .env
OZON_PROXY=http://your-proxy:8080

python parse_ozon_sellers.py
```

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –£—Å–ø–µ—Ö:
- ‚úÖ –ë–æ–ª—å—à–µ cookies –ø–æ–ª—É—á–µ–Ω–æ —á–µ—Ä–µ–∑ Playwright (–Ω–µ —Ç–æ–ª—å–∫–æ `abt_data` –∏ `__Secure-ETC`)
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –∫ entrypoint API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 200 –≤–º–µ—Å—Ç–æ 403
- ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ 403:
- –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç `OzonAntibotException` —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å headless=False –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
- –£–≤–µ–ª–∏—á–∏—Ç—å `request_delay` –¥–æ 5-10 —Å–µ–∫—É–Ω–¥

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É Playwright
pip show playwright playwright-stealth
playwright --version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç stealth
python -c "from playwright_stealth import stealth; print('OK')"

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ Ozon
curl -I https://www.ozon.ru/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookies —á–µ—Ä–µ–∑ Playwright –Ω–∞–ø—Ä—è–º—É—é
python -c "from src.utils.playwright_cookies import get_ozon_cookies_playwright; import asyncio; print(asyncio.run(get_ozon_cookies_playwright()))"
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –Ω–µ –ø–æ–º–æ–≥—É—Ç:

1. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã** (residential proxy)
2. **–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏** –¥–æ 10-15 —Å–µ–∫—É–Ω–¥
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DeepSeek –ø–æ–¥—Ö–æ–¥**: Playwright –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–µ —Ç–æ–ª—å–∫–æ cookies
4. **–ü–∞—Ä—Å–∏—Ç—å HTML** –≤–º–µ—Å—Ç–æ API (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
