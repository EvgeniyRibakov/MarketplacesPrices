# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üìä –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç **Grok, ChatGPT –∏ Perplexity** –¥–ª—è –æ–±—Ö–æ–¥–∞ –∞–Ω—Ç–∏–±–æ—Ç-—Å–∏—Å—Ç–µ–º—ã Ozon.
–ò–¥–µ–∏ –æ—Ç **DeepSeek** (—Ä–∞–¥–∏–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Playwright) –æ—Ç–ª–æ–∂–µ–Ω—ã.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **OzonAntibotException** (Perplexity Fix #2)
- **–§–∞–π–ª:** `src/exceptions.py`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —è–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 403** (Perplexity Fix #2)
- **–§–∞–π–ª:** `src/api/ozon_catalog_api.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –î–µ—Ç–µ–∫—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ `ozon-antibot`
  - –°—á–µ—Ç—á–∏–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –∞–Ω—Ç–∏–±–æ—Ç–∞
  - –í—ã–±—Ä–æ—Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
  - –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ retry (5 —Å–µ–∫)
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û

### 3. **–£–≤–µ–ª–∏—á–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏** (Grok/ChatGPT)
- **–§–∞–π–ª:** `src/api/ozon_catalog_api.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - `request_delay`: 1.0 ‚Üí 3.0 —Å–µ–∫
  - `max_concurrent`: 3 ‚Üí 2
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í–ê–ñ–ù–û

### 4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ proxy** (Perplexity Fix #5)
- **–§–∞–π–ª:** `src/api/ozon_catalog_api.py`
- **–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
  - –ü–∞—Ä–∞–º–µ—Ç—Ä `proxy` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ `.env`: `OZON_PROXY`
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è proxy
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

### 5. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ cookies** (Perplexity Fix #4)
- **–§–∞–π–ª:** `src/api/ozon_catalog_api.py`
- **–ú–µ—Ç–æ–¥:** `_log_cookies_diagnostic()`
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
  - –ò—Å—Ç–æ—á–Ω–∏–∫ cookies
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∏–º–µ–Ω–∞
  - –ü–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ü–û–õ–ï–ó–ù–û

### 6. **–ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Playwright** (ChatGPT)
- **–§–∞–π–ª:** `src/utils/playwright_cookies.py`
- **–£–ª—É—á—à–µ–Ω–∏—è:**
  - –î–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ (—Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
  - –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (4 —ç—Ç–∞–ø–∞ –ø–æ 25%)
  - –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (1-2 —Å–µ–∫)
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í–ê–ñ–ù–û

### 7. **–§–ª–∞–≥ headless –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏** (ChatGPT)
- **–§–∞–π–ª—ã:** 
  - `src/utils/playwright_cookies.py`
  - `.env_sample`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä:** `OZON_PLAYWRIGHT_HEADLESS`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `False` –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ü–û–õ–ï–ó–ù–û

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ/–ø–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ | –ü–æ—Å–ª–µ |
|----------|-----|---------|
| –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ | 1.0 —Å–µ–∫ | 3.0 —Å–µ–∫ |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | 3 | 2 |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ 403 | –ü—Ä–æ—Å—Ç–æ–π retry | OzonAntibotException + –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| Proxy | ‚ùå | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ë–∞–∑–æ–≤–∞—è | –ú—ã—à—å + —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ |
| –û—Ç–ª–∞–¥–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ | ‚ùå | ‚úÖ headless=False |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ cookies | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –ü–æ–¥—Ä–æ–±–Ω–∞—è |

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```bash
python parse_ozon_sellers.py
```

### –° –æ—Ç–ª–∞–¥–∫–æ–π –±—Ä–∞—É–∑–µ—Ä–∞:
```env
# –í .env
OZON_PLAYWRIGHT_HEADLESS=False
```

### –° proxy:
```env
# –í .env
OZON_PROXY=http://proxy.example.com:8080
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `src/exceptions.py` (–ù–û–í–´–ô)
2. ‚úÖ `src/api/ozon_catalog_api.py`
3. ‚úÖ `src/utils/playwright_cookies.py`
4. ‚úÖ `src/utils/browser_cookies.py`
5. ‚úÖ `.env_sample`
6. ‚úÖ `docs/OZON_ANTIBOT_FIXES.md` (–ù–û–í–´–ô)

---

## ‚è≠Ô∏è –ß—Ç–æ –¥–∞–ª—å—à–µ

### –ï—Å–ª–∏ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–º–æ–≥–ª–∏:
- ‚úÖ Cookies –ø–æ–ª—É—á–µ–Ω—ã (>2 —à—Ç—É–∫)
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200
- ‚úÖ –¢–æ–≤–∞—Ä—ã —É—Å–ø–µ—à–Ω–æ –ø–∞—Ä—Å—è—Ç—Å—è

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ 403:
1. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å headless=False** ‚Üí –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–Ω—Ç–∏–±–æ—Ç
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏** ‚Üí —Å–º–µ–Ω–∏—Ç—å IP –∞–¥—Ä–µ—Å
3. **–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏** ‚Üí `request_delay=10.0`
4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DeepSeek –ø–æ–¥—Ö–æ–¥** ‚Üí Playwright –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ cookies)

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
```
‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ X cookies —á–µ—Ä–µ–∑ Playwright
üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ cookies
```

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã:
```
üö´ Ozon antibot –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
‚ùå OzonAntibotException: Ozon antibot –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º.:
- `docs/OZON_ANTIBOT_FIXES.md` ‚Äî –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- `docs/ideas_debug_403` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç 4 –ò–ò
