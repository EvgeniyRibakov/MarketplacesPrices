# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ F12

## üîç Root Cause Analysis

### –ü—Ä–æ–±–ª–µ–º–∞
–ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 12 —Ç–æ–≤–∞—Ä–æ–≤ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞), —Ö–æ—Ç—è —É –ø—Ä–æ–¥–∞–≤—Ü–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —Ç–æ–≤–∞—Ä–æ–≤.

### –î–∞–Ω–Ω—ã–µ –∏–∑ F12 (DevTools)
–ò–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 2 –≤–∏–¥–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É URL:
```
/api/entrypoint-api.bx/page/json/v2?url=%2Fseller%2Fgaya-206756%2F%3F
  layout_page_index%3D2
  %26page%3D2
  %26paginator_token%3D3618992
  %26search_page_state%3D-htHdq2eAvm1JggRLWM6GK0xNL8AHtyRtC_I4aYAwsqPCGcnB1pvmE-KHkwRZ5FWo4koo49IFJuwbxmgIRfj7mgcEsr3id0pg57WeiB2WHYDypWT48RgtX3xppeoqE-0biRsTi0%253D
  %26start_page_id%3Deed1890e440cf2c82e090765d6a90d75
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:**
- `page=2` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `paginator_token=3618992` - —Ç–æ–∫–µ–Ω –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- `search_page_state=...` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞ (–∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
- `layout_page_index=2` - –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ layout
- `start_page_id=...` - ID –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### Root Cause (–∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞)

**–°—Ç—Ä–æ–∫–∞ 922 –≤ `src/api/ozon_catalog_api.py`**:
```python
logger.debug(f"  ‚Ä¢ –ö–ª—é—á–∏ –≤ state_data: {list(state_data.keys())[:15]}")
# –í—ã–≤–æ–¥: ['options', 'sharedData', 'items', 'templates', 'cols', 'imageHeight', 'columnsCount', 'page']
```

–ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–¥ –∏—â–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
1. ‚ùå –ò—â–µ—Ç `nextPage`, `next`, `pagination` –≤ `state_data`, –Ω–æ –∏—Ö —Ç–∞–º –Ω–µ—Ç
2. ‚úÖ –ï—Å—Ç—å –ø–æ–ª–µ `sharedData`, –Ω–æ –æ–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
3. ‚úÖ –ï—Å—Ç—å –ø–æ–ª–µ `pageInfo` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ, –Ω–æ –æ–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
4. ‚ùå –¢–æ–∫–µ–Ω—ã `paginatorToken` –∏ `searchPageState` –Ω–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –æ—Ç–≤–µ—Ç–∞

### –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

**–°—Ç—Ä–æ–∫–∞ 968**:
```python
logger.debug(f"  ‚Ä¢ ‚ö†Ô∏è –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞...")
```

–ö–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `sharedData` –≤ `state_data`
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `pageInfo` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–≤—Ä–∏—Å—Ç–∏–∫—É (–µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 12 —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ sharedData (—Å—Ç—Ä–æ–∫–∏ 930-945)
```python
shared_data = state_data.get("sharedData", {})
if shared_data:
    if "paginatorToken" in shared_data:
        paginator_token = shared_data.get("paginatorToken")
    if "searchPageState" in shared_data:
        search_page_state = shared_data.get("searchPageState")
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ pageInfo (—Å—Ç—Ä–æ–∫–∏ 981-990)
```python
page_info = first_page_data.get("pageInfo", {})
if page_info:
    if "nextPage" in page_info:
        next_page_url = page_info.get("nextPage")
    if "pagination" in page_info:
        pagination_info = page_info.get("pagination")
```

#### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 1003-1006)
```python
# –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 12 —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞), –Ω–æ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤,
# –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º page
if not next_page_url and not pagination_info and len(products) == 12:
    try_next_page_heuristic = True
    # –ü—Ä–æ–±—É–µ–º page=2 –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤ (Ozon –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å)
```

#### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ü–∏–∫–ª–µ (—Å—Ç—Ä–æ–∫–∏ 1100-1129)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ `sharedData` –≤ `state_data`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ `pageInfo` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ
- –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–ë—ã–ª–æ:**
```python
# –ò—â–µ—Ç —Ç–æ–ª—å–∫–æ –≤ state_data –Ω–∞–ø—Ä—è–º—É—é
if "paginatorToken" in state_data:
    paginator_token = state_data.get("paginatorToken")
```

**–°—Ç–∞–ª–æ:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç sharedData –≤ state_data
shared_data = state_data.get("sharedData", {})
if shared_data:
    if "paginatorToken" in shared_data:
        paginator_token = shared_data.get("paginatorToken")
    if "searchPageState" in shared_data:
        search_page_state = shared_data.get("searchPageState")

# –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç pageInfo
page_info = first_page_data.get("pageInfo", {})
if page_info:
    # ...
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí 12 —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí –ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚ùå
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí 12 —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí –Ω–∞–π–¥–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã –≤ sharedData/pageInfo ‚Üí 
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 ‚Üí 12 —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí –Ω–∞–π–¥–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã ‚Üí 
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 3 ‚Üí ... ‚Üí 
–ü–æ–∫–∞ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–æ < 12 —Ç–æ–≤–∞—Ä–æ–≤ ‚úÖ
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ Ozon API (–Ω–∞ –æ—Å–Ω–æ–≤–µ F12)
```json
{
  "widgetStates": {
    "tileGridDesktop-...": {
      "items": [...],
      "sharedData": {
        "paginatorToken": "3618992",
        "searchPageState": "..."
      },
      "page": 1
    }
  },
  "pageInfo": {
    "nextPage": "...",
    "pagination": {...}
  }
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º `widgetStates` ‚Üí `tileGridDesktop` ‚Üí `sharedData` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º `pageInfo` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ
3. –ü—Ä–æ–≤–µ—Ä—è–µ–º `state_data` –Ω–∞–ø—Ä—è–º—É—é (fallback)
4. –ò—Å–ø–æ–ª—å–∑—É–µ–º —ç–≤—Ä–∏—Å—Ç–∏–∫—É: –µ—Å–ª–∏ 12 —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

### –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
–ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 12 —Ç–æ–≤–∞—Ä–æ–≤ (—Ç–∏–ø–∏—á–Ω–∞—è –ø–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞), –Ω–æ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤:
- –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å `page=2` –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤
- Ozon –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –∏ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ
- –ò–∑ –æ—Ç–≤–µ—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `src/api/ozon_catalog_api.py`:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `sharedData` –≤ `state_data` (—Å—Ç—Ä–æ–∫–∏ 930-945)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `pageInfo` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ (—Å—Ç—Ä–æ–∫–∏ 981-990, 1133-1144)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 1003-1006, 1150-1156)
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ü–∏–∫–ª–µ (—Å—Ç—Ä–æ–∫–∏ 1100-1129)

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω—ã –Ω–∞–π–¥–µ–Ω—ã –≤ `sharedData` –∏–ª–∏ `pageInfo`
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö** - –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
2. **–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞** - –µ—Å–ª–∏ —É –ø—Ä–æ–¥–∞–≤—Ü–∞ —Ä–æ–≤–Ω–æ 12 —Ç–æ–≤–∞—Ä–æ–≤, –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ª–∏—à–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. **–¢–æ–∫–µ–Ω—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞** - –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã 2 –Ω—É–∂–Ω—ã —Ç–æ–∫–µ–Ω—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 1, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `sharedData` –∏–ª–∏ `pageInfo`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
- –ù–∞–π–¥–µ–Ω—ã –ª–∏ —Ç–æ–∫–µ–Ω—ã –≤ `sharedData`?
- –ù–∞–π–¥–µ–Ω—ã –ª–∏ —Ç–æ–∫–µ–Ω—ã –≤ `pageInfo`?
- –ö–∞–∫–∏–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `sharedData`?
- –ö–∞–∫–∏–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `pageInfo`?

–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ—Ç–≤–µ—Ç–∞ –∏ –ø–æ–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.
